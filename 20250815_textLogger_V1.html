<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timestamped Notes Tool</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    #top-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        background-color: #1e1e1e;
        border-bottom: 1px solid #333;
    }
    #fileNameInput {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border: 1px solid #444;
        border-radius: 5px;
        padding: 6px 10px;
        font-size: 1em;
        width: 60%;
        text-align: center;
    }
    #table-container {
        flex: 1;
        overflow-y: auto;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
    }
    th, td {
        border: 1px solid #333;
        padding: 8px;
        vertical-align: top;
    }
    th {
        background-color: #1e1e1e;
        position: sticky;
        top: 0;
    }
    td {
        white-space: pre-wrap;
        word-break: break-word;
    }
    td.timestamp {
        white-space: nowrap;
        vertical-align: middle;
        width: 1%;
    }
    td.delete-cell {
        width: 30px;
        text-align: center;
        cursor: pointer;
        color: #ff4c4c;
    }
    td.delete-cell:hover {
        color: #ff1a1a;
    }
    #input-bar {
        display: flex;
        background-color: #1e1e1e;
        padding: 10px;
        border-top: 1px solid #333;
        position: relative;
    }
    textarea {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 5px;
        resize: none;
        background-color: #2a2a2a;
        color: #e0e0e0;
        font-size: 1em;
        min-height: 50px;
        max-height: 150px;
    }
    button {
        margin-left: 10px;
        padding: 10px 15px;
        background-color: #333;
        color: #e0e0e0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    button:hover {
        background-color: #444;
    }
</style>
</head>
<body>

<div id="top-bar">
    <input type="text" id="fileNameInput" placeholder="Enter CSV file name (without extension)" />
</div>

<div id="table-container">
    <table id="notesTable">
        <thead>
            <tr>
                <th></th>
                <th>Timestamp</th>
                <th>Text</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div id="input-bar">
    <textarea id="noteInput" placeholder="Type your note... (Enter to save, Shift+Enter for new line)"></textarea>
    <button onclick="exportCSV()">Export CSV</button>
</div>

<script>
const noteInput = document.getElementById('noteInput');
const tableBody = document.querySelector('#notesTable tbody');
const tableContainer = document.getElementById('table-container');
const fileNameInput = document.getElementById('fileNameInput');
let notes = [];

// Adjust table container height dynamically for mobile keyboard
function adjustTableHeight() {
    const windowHeight = window.innerHeight;
    const inputBarHeight = document.getElementById('input-bar').offsetHeight;
    const topBarHeight = document.getElementById('top-bar').offsetHeight;
    tableContainer.style.height = (windowHeight - inputBarHeight - topBarHeight) + "px";
}
adjustTableHeight();
window.addEventListener('resize', adjustTableHeight);

noteInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        addNote();
    }
});

function addNote() {
    const text = noteInput.value.trim();
    if (!text) return;

    const timestamp = new Date().toLocaleString();
    notes.push({ timestamp, text });

    const row = tableBody.insertRow();

    // Delete cell
    const deleteCell = row.insertCell(0);
    deleteCell.innerHTML = "ðŸ—‘ï¸";
    deleteCell.className = "delete-cell";
    deleteCell.onclick = () => {
        tableBody.removeChild(row);
        notes = notes.filter(n => n.timestamp !== timestamp || n.text !== text);
    };

    // Timestamp cell
    const cell1 = row.insertCell(1);
    cell1.textContent = timestamp;
    cell1.className = "timestamp";

    // Text cell
    const cell2 = row.insertCell(2);
    cell2.textContent = text;

    noteInput.value = "";
    noteInput.focus();

    // Auto-scroll to the last note
    tableContainer.scrollTop = tableContainer.scrollHeight;
}

function exportCSV() {
    if (!notes.length) {
        alert("No notes to export.");
        return;
    }

    let filename = fileNameInput.value.trim() || "notes";
    if (!filename.endsWith(".csv")) filename += ".csv";

    // CSV content without the data URI prefix
    let csvContent = `"Timestamp","Text"\r\n`;
    notes.forEach(note => {
        const safeText = note.text.replace(/"/g, '""').replace(/\n/g, '\r\n');
        csvContent += `"${note.timestamp}","${safeText}"\r\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
