<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Path Game</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #111;
    font-family: sans-serif;
  }
  #gameCanvas {
    display: block;
    background-color: #222;
  }
  #endScreen {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 2em;
    text-align: center;
    display: none;
  }
  #endScreen button {
    margin-top: 20px;
    padding: 10px 15px;
    font-size: 1em;
    border: none;
    border-radius: 5px;
    background-color: #0f62fe;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="endScreen">
  <div id="scoreText">Mazes Completed: 0</div>
  <button id="restartBtn">Restart</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let tiltX = 0;
let tiltY = 0;

const gridSize = 9;
let cellSize;
let ballSize;
let ball = {};
let path = [];
let completedMazes = 0;

// End screen elements
const endScreen = document.getElementById('endScreen');
const scoreText = document.getElementById('scoreText');
const restartBtn = document.getElementById('restartBtn');

// Resize canvas
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  cellSize = Math.min(canvas.width, canvas.height) / gridSize;
  ballSize = cellSize * 0.6;
}
resizeCanvas();

// Device orientation
function handleOrientation(event) {
  tiltX = event.gamma / 90;
  tiltY = event.beta / 90;
}
window.addEventListener('deviceorientation', handleOrientation);

// Generate a random path from top-left to bottom-right
function generatePath() {
  path = [];
  let x = 0;
  let y = 0;
  path.push({x,y});
  
  while(x < gridSize - 1 || y < gridSize - 1){
    const moves = [];
    if(x < gridSize - 1) moves.push({x:x+1,y});
    if(y < gridSize - 1) moves.push({x,y:y+1});
    const move = moves[Math.floor(Math.random()*moves.length)];
    path.push(move);
    x = move.x;
    y = move.y;
  }

  // Ball starts at path start
  ball.x = path[0].x*cellSize + cellSize/2;
  ball.y = path[0].y*cellSize + cellSize/2;
  ball.vx = 0;
  ball.vy = 0;
}

// Check if ball is on the path
function isOnPath(ball){
  for(const cell of path){
    const cx = cell.x*cellSize + cellSize/2;
    const cy = cell.y*cellSize + cellSize/2;
    if(Math.abs(ball.x - cx) < cellSize/2 && Math.abs(ball.y - cy) < cellSize/2){
      return true;
    }
  }
  return false;
}

function update() {
  ball.vx += tiltX*2.5;
  ball.vy += tiltY*2.5;
  const maxSpeed = cellSize*0.3;
  ball.vx = Math.max(-maxSpeed, Math.min(maxSpeed, ball.vx));
  ball.vy = Math.max(-maxSpeed, Math.min(maxSpeed, ball.vy));
  ball.x += ball.vx;
  ball.y += ball.vy;
  ball.vx *= 0.85;
  ball.vy *= 0.85;

  // Check if off path
  if(!isOnPath(ball)){
    endScreen.style.display = 'block';
    scoreText.innerText = `Mazes Completed: ${completedMazes}`;
  }

  // Check if reached finish
  const finish = path[path.length-1];
  const fx = finish.x*cellSize + cellSize/2;
  const fy = finish.y*cellSize + cellSize/2;
  const dx = ball.x - fx;
  const dy = ball.y - fy;
  if(Math.sqrt(dx*dx + dy*dy) < ballSize/2){
    completedMazes++;
    generatePath();
  }
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // Draw path
  ctx.fillStyle = '#555';
  for(const cell of path){
    ctx.fillRect(cell.x*cellSize, cell.y*cellSize, cellSize, cellSize);
  }

  // Draw ball
  ctx.fillStyle = '#f00';
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ballSize/2,0,Math.PI*2);
  ctx.fill();

  // Draw finish
  const finish = path[path.length-1];
  ctx.fillStyle = '#0f0';
  ctx.beginPath();
  ctx.arc(finish.x*cellSize + cellSize/2, finish.y*cellSize + cellSize/2, ballSize/2,0,Math.PI*2);
  ctx.fill();
}

function gameLoop() {
  if(endScreen.style.display === 'none'){
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }
}

// Restart button
restartBtn.addEventListener('click', ()=>{
  completedMazes = 0;
  endScreen.style.display = 'none';
  generatePath();
  gameLoop();
});

// Resize
window.addEventListener('resize', ()=>{
  resizeCanvas();
  generatePath();
});

// Start
generatePath();
gameLoop();
</script>
</body>
</html>
