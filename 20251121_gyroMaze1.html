<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gyro Ball Test</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:black; }
#canvas { display:block; background:black; }
#debug { position:absolute; top:10px; left:10px; color:#0f0; font-family: monospace; font-size:1.2em; }
#startBtn { 
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  font-size:1.5em; padding:10px 15px;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="debug">tiltX: 0 | tiltY: 0</div>
<button id="startBtn">Start Gyro</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const debugDiv = document.getElementById('debug');
const startBtn = document.getElementById('startBtn');

let tiltX=0, tiltY=0;
let ball = {x:0, y:0, vx:0, vy:0};
let ballRadius = 30;

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ball.x = canvas.width/2;
  ball.y = canvas.height/2;
}
window.addEventListener('resize', resize);
resize();

// Handle orientation
function handleOrientation(e){
  tiltX = e.gamma/90; // left-right
  tiltY = e.beta/90;  // front-back
}

// Update ball position
function update(){
  ball.vx += tiltX*5;
  ball.vy += tiltY*5;

  // Limit speed
  const maxSpeed = 20;
  ball.vx = Math.max(-maxSpeed, Math.min(maxSpeed, ball.vx));
  ball.vy = Math.max(-maxSpeed, Math.min(maxSpeed, ball.vy));

  ball.x += ball.vx;
  ball.y += ball.vy;

  // Friction
  ball.vx *= 0.9;
  ball.vy *= 0.9;

  // Keep inside canvas
  ball.x = Math.max(ballRadius, Math.min(canvas.width - ballRadius, ball.x));
  ball.y = Math.max(ballRadius, Math.min(canvas.height - ballRadius, ball.y));
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2);
  ctx.fill();

  // Debug
  debugDiv.innerText = `tiltX: ${tiltX.toFixed(2)} | tiltY: ${tiltY.toFixed(2)}`;
}

// Game loop
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// Start button for mobile permission
startBtn.addEventListener('click', ()=>{
  if(typeof DeviceOrientationEvent !== 'undefined' &&
     typeof DeviceOrientationEvent.requestPermission === 'function'){
       DeviceOrientationEvent.requestPermission().then(res=>{
         if(res==='granted'){
           window.addEventListener('deviceorientation', handleOrientation);
         } else {
           alert('Permission denied');
         }
       }).catch(console.error);
  } else {
    window.addEventListener('deviceorientation', handleOrientation);
  }
  startBtn.style.display='none';
  loop();
});
</script>
</body>
</html>
